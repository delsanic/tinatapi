<div class="container container-main">
    <div class="row">
        <div class="col-sm-12">
            <h1>
                LGBT rights
            </h1>
            <p class="lead">
                Countries where members of the Lesbian Gay Bisexual & Transgender Community are subject to persecution
            </p>
            <ul class="list-unstyled map-legend">
                <li>
                    <div class="colorWell pull-left" style="background: gold;"></div>
                    <span class="pull-left">Subject to persecution</span>
                </li>
                <li>
                    <div class="colorWell pull-left" style="background: orange;"></div>
                    <span class="pull-left">Subject to imprisonment</span>
                </li>
                <li>
                    <div class="colorWell pull-left" style="background: maroon;"></div>
                    <span class="pull-left">Subject to the death penalty</span>
                </li>
            </ul>
            <div id="map" class="world-map">
                <h3 class="country-name"></h3>
            </div>
            <p class="text-right">
                 Map created with <a href="http://polymaps.org">PolyMaps</a>, the <a href="http://thematicmapping.org">World Borders Dataset</a> and <strong>Tinatapi</strong>.
            </p>
         </div>
    </div>
</div>
<script type="text/javascript" src="/js/modernizr.min.js"></script>
<script type="text/javascript" src="/js/polymaps.min.js"></script>
<script type="text/javascript" src="/js/nns.min.js"></script>
<script>
var po = org.polymaps;

var map = po.map()
    .container(document.getElementById("map").appendChild(po.svg("svg")))
    .center({lat: 30, lon: 0})
    .zoom(2.1);

map.add(po.geoJson()
    .url("/js/world-polymap.json")
    .tile(false)
    .zoom(3)
    .on("load", plotMap));

function plotMap(e) {
    $.getJSON( "/countries.json", function(countries) {

        $('#map').css({visibility: 'visible'});
        
        for (var i = 0; i < e.features.length; i++) {
            var feature = e.features[i];
                
            var tileText = feature.data.properties.name;
            var tileStyle = "fill: transparent;";
            tileStyle = "fill: #ccc;";
            
            
            for (c in countries) {
                if (feature.data.properties.iso2 == countries[c].iso2) {
                    // Check for warnings
                    if (countries[c].warnings) {
                    
                        // Check for warnings in 'high'
                        if (countries[c].warnings.high) {
                            if (countries[c].warnings.high.lgbtDeathPenalty)
                                tileStyle = "fill: maroon;";
                     
                            if (countries[c].warnings.high.lgbtImprisonment)
                                tileStyle = "fill: orange;";
                        }
                                                
                        // Check for warnings in 'medium'
                        if (countries[c].warnings.medium)
                            if (countries[c].warnings.medium.lgbtPersecution)
                                tileStyle = "fill: gold;";
                    }
                }
            }

            $(feature.element).on('mouseover', function() {
                $('.country-name').html( $(this).data('countryName') );
            });

            $(feature.element).on('mouseout', function() {
                $('.country-name').html('');
            });

            $(feature.element).on('click touch', function() {
                window.location = "/countries/"+encodeURIComponent( $(this).data('countryName').replace(" ", "_") );
            });

            n$(feature.element)
                .attr("style", tileStyle)
                .attr("class", "interactive")
                .attr("data-toggle", "popover")
                .attr("data-placement", "top")
                .attr("data-country-name", feature.data.properties.name)
                .text(tileText)
                .add("svg:title");
        }
    });
}
</script>